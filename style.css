/* ===============================
   全体
=============================== */
html, body {
  margin: 0; padding: 0; height: 100%;
  box-sizing: border-box;
  font-family: "Helvetica", "Arial", sans-serif;
  -webkit-text-size-adjust: 100%; /* iOSの勝手な拡大抑止 */
}
*, *::before, *::after { box-sizing: inherit; }

/* ===============================
   ヘッダー
=============================== */
#topBar {
  background: #fff; border-bottom: 1px solid #ccc;
  height: 48px; display: flex; align-items: center;
}
.sidebar-toggle {
  margin-left: 10px; background: #fff; border: 1px solid #ccc; border-radius: 4px;
  padding: 6px 10px; cursor: pointer; position: relative;
  touch-action: manipulation; /* ダブルタップズーム回避 */
}
.sidebar-toggle .sidebar-unread {
  position: absolute; top: -5px; right: -5px; width: 10px; height: 10px;
  background: red; border-radius: 50%; pointer-events: none;
}

/* ===============================
   レイアウト
=============================== */
#container {
  display: flex; height: calc(100dvh - 48px); background-color: #8AAECB;
}
#talkList {
  width: 0; overflow: hidden; background: #fff; border-right: 1px solid #ccc;
  transition: width 0.3s ease, transform 0.25s ease, visibility 0s linear 0.25s;
}
#talkList.open { width: 150px; }

/* サイドバー項目 */
.talk-item {
  padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; position: relative;
  transition: background-color 0.2s;
}
.talk-item:hover { background-color: #f0f0f0; }
.talk-item-name { font-size: 14px; font-weight: bold; color: #333; }
.unread-icon {
  width: 10px; height: 10px; background: red; border-radius: 50%;
  position: absolute; top: 15px; right: 10px;
}

/* チャットエリア */
#chatArea { flex: 1; display: flex; flex-direction: column; position: relative; z-index: 0; }
#messageContainer {
  flex: 1; overflow-y: auto; padding: 12px; background: #8AAECB;
  -webkit-overflow-scrolling: touch;
  /* ▼ 末尾が入力UIに隠れないためのスクロール余白 */
  scroll-padding-bottom: var(--input-h, 96px);
}
.message-row { display: flex; align-items: flex-end; margin: 9px 0; }
.message-left { justify-content: flex-start; }
.message-right { justify-content: flex-end; }

.icon {
  width: 36px; height: 36px; flex-shrink: 0; border-radius: 50%;
  background-color: #ccc; background-size: cover; background-position: center; margin: 0 8px;
}
.sp001-icon { background-image: url('https://raw.githubusercontent.com/yretsym00/message/main/docs/same.png'); }
.sp002-icon { background-image: url('https://raw.githubusercontent.com/yretsym00/message/main/docs/kurage.png'); }
.speaker-icon { background-image: url('https://raw.githubusercontent.com/xxx/xxx/main/speaker_dummy.png'); }

.message-bubble {
  border-radius: 12px; padding: 8px 12px; max-width: 88%;
  line-height: 1.5; font-size: 15px; /* 表示用。フォームではないのでOK */
  word-wrap: break-word; white-space: pre-wrap; color: #111;
  background-color: #fff; margin: 0 8px;
}
.message-right .message-bubble { background-color: #9EEA9C; }
.message-bubble img { max-width: 100%; height: auto; display: block; border-radius: 8px; }

.bubble-wrapper { position: relative; display: inline-block; }
.metadata {
  position: absolute; bottom: 0; font-size: 9px; color: #666; line-height: 1.4;
  display: flex; flex-direction: column; white-space: nowrap;
}
.metadata-speaker { left: 100%; margin-left: 3px; }
.metadata-user { right: 100%; margin-right: 6px; align-items: flex-end; }

/* 選択肢エリア */
#choicesArea {
  display: none; padding: 10px; background: #8AAECB; border-top: 1px solid #8AAECB;
}
#choicesArea button {
  display: block; width: 100%; margin-bottom: 8px;
  font-size: 17px; /* 16px以上でズーム抑止 */
  padding: 12px 16px; cursor: pointer;
  border: 1px solid #ccc; border-radius: 14px; background: #fff; color: #333;
  box-shadow: none; transition: background 0.2s, box-shadow 0.2s;
  touch-action: manipulation;
}
#choicesArea button:hover { background-color: #f0f0f0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

/* 入力エリア */
#inputArea {
  background: #fff; border-top: 1px solid #ccc; padding: 10px;
  position: sticky; bottom: 0; padding-bottom: max(10px, env(safe-area-inset-bottom));
}
.input-container {
  display: flex; align-items: center; background: #f7f7f7; border: 1px solid #ddd;
  border-radius: 24px; padding: 6px 10px;
}
.input-container .icon-button {
  background: none; border: none; cursor: pointer; font-size: 20px; /* 16px以上 */
  width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
  color: #666; border-radius: 50%; transition: background 0.2s; padding: 0; margin: 0;
  touch-action: manipulation;
}
.input-container .icon-button:hover { background: rgba(0,0,0,0.1); }

.input-container input {
  flex: 1; border: none; outline: none; background: transparent; margin: 0 8px;
  font-size: 17px; /* 16px以上でズーム抑止 */
}

/* タイピング */
.typing-indicator .message-bubble {
  background: #fff; color: #888; font-style: italic; min-width: 28px; text-align: center;
}

/* モバイル最適化（ドロワー＋重なり順） */
@media (max-width: 900px) {
  #container { position: relative; }

  #talkList {
    position: absolute; top: 0; left: 0; height: calc(100dvh - 48px);
    width: min(80vw, 300px); box-shadow: 2px 0 12px rgba(0,0,0,0.15);
    transform: translateX(-100%); visibility: hidden; z-index: 1000; /* 前面へ */
  }
  #talkList.open { transform: translateX(0); visibility: visible; }

  body.drawer-open { overflow: hidden; touch-action: none; }

  .metadata {
    position: static; margin-top: 4px; font-size: 10px; color: #666;
    display: flex; gap: 6px;
  }
  .metadata-user, .metadata-speaker { margin: 0; right: auto; left: auto; }

  #topBar { position: sticky; top: 0; z-index: 1100; }
}
